@model JTX_Ecom.Models.DTOs.CheckoutDto

@{
    ViewData["Title"] = "Checkout";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var cartSummary = ViewBag.CartSummary as JTX_Ecom.Models.DTOs.CartSummaryDto;
    var malaysianStates = ViewBag.MalaysianStates as List<string>;
}

<div class="container py-5">
    <div class="row">
        <div class="col-12 mb-4">
            <h2><i class="bi bi-credit-card"></i> Checkout</h2>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a asp-action="Index">Cart</a></li>
                    <li class="breadcrumb-item active">Checkout</li>
                </ol>
            </nav>
        </div>
    </div>

    <form asp-controller="Orders" asp-action="ProcessCheckout" method="post">
        <div class="row">
            <!-- Billing Information -->
            <div class="col-lg-7">
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="bi bi-person-fill"></i> Billing Information</h5>
                    </div>
                    <div class="card-body">
                        <div asp-validation-summary="ModelOnly" class="alert alert-danger"></div>

                        <div class="mb-3">
                            <label asp-for="CustomerName" class="form-label">Full Name *</label>
                            <input asp-for="CustomerName" class="form-control" placeholder="Enter your full name" />
                            <span asp-validation-for="CustomerName" class="text-danger"></span>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label asp-for="CustomerEmail" class="form-label">Email Address *</label>
                                <input asp-for="CustomerEmail" class="form-control" placeholder="your.email@example.com" />
                                <span asp-validation-for="CustomerEmail" class="text-danger"></span>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label asp-for="CustomerPhone" class="form-label">Phone Number *</label>
                                <input asp-for="CustomerPhone" class="form-control" placeholder="012-3456789" />
                                <span asp-validation-for="CustomerPhone" class="text-danger"></span>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label asp-for="BillingAddress" class="form-label">Address *</label>
                            <textarea asp-for="BillingAddress" class="form-control" rows="2" placeholder="Street address"></textarea>
                            <span asp-validation-for="BillingAddress" class="text-danger"></span>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label asp-for="City" class="form-label">City *</label>
                                <input asp-for="City" class="form-control" placeholder="e.g., Kuala Lumpur" />
                                <span asp-validation-for="City" class="text-danger"></span>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label asp-for="State" class="form-label">State *</label>
                                <select asp-for="State" class="form-select">
                                    <option value="">Select State</option>
                                    @foreach (var state in malaysianStates ?? new List<string>())
                                    {
                                        <option value="@state">@state</option>
                                    }
                                </select>
                                <span asp-validation-for="State" class="text-danger"></span>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label asp-for="PostalCode" class="form-label">Postal Code *</label>
                            <input asp-for="PostalCode" class="form-control" placeholder="12345" maxlength="5" />
                            <span asp-validation-for="PostalCode" class="text-danger"></span>
                            <small class="form-text text-muted">5 digits postal code</small>
                        </div>
                    </div>
                </div>

                <!-- Payment Method -->
                <div class="card">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0"><i class="bi bi-wallet2"></i> Payment Method</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">Select Payment Method *</label>
                            
                            <div class="form-check mb-2">
                                <input asp-for="PaymentMethod" class="form-check-input" type="radio" value="FPX" id="fpx" checked />
                                <label class="form-check-label" for="fpx">
                                    <strong>FPX (Online Banking)</strong>
                                    <small class="text-muted d-block">Pay directly from your bank account</small>
                                </label>
                            </div>

                            <div class="form-check mb-2">
                                <input asp-for="PaymentMethod" class="form-check-input" type="radio" value="Credit Card" id="credit" />
                                <label class="form-check-label" for="credit">
                                    <strong>Credit Card</strong>
                                    <small class="text-muted d-block">Visa, Mastercard, Amex</small>
                                </label>
                            </div>

                            <div class="form-check mb-2">
                                <input asp-for="PaymentMethod" class="form-check-input" type="radio" value="Debit Card" id="debit" />
                                <label class="form-check-label" for="debit">
                                    <strong>Debit Card</strong>
                                    <small class="text-muted d-block">Visa Debit, Mastercard Debit</small>
                                </label>
                            </div>

                            <div class="form-check mb-2">
                                <input asp-for="PaymentMethod" class="form-check-input" type="radio" value="TNG eWallet" id="tng" />
                                <label class="form-check-label" for="tng">
                                    <strong>Touch 'n Go eWallet</strong>
                                    <small class="text-muted d-block">Pay with TNG eWallet</small>
                                </label>
                            </div>

                            <div class="form-check mb-2">
                                <input asp-for="PaymentMethod" class="form-check-input" type="radio" value="GrabPay" id="grab" />
                                <label class="form-check-label" for="grab">
                                    <strong>GrabPay</strong>
                                    <small class="text-muted d-block">Pay with GrabPay</small>
                                </label>
                            </div>

                            <div class="form-check">
                                <input asp-for="PaymentMethod" class="form-check-input" type="radio" value="Boost" id="boost" />
                                <label class="form-check-label" for="boost">
                                    <strong>Boost</strong>
                                    <small class="text-muted d-block">Pay with Boost eWallet</small>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Order Summary -->
            <div class="col-lg-5">
                <div class="card sticky-top" style="top: 20px;">
                    <div class="card-header bg-light">
                        <h5 class="mb-0">Order Summary</h5>
                    </div>
                    <div class="card-body">
                        @if (cartSummary != null)
                        {
                            @foreach (var item in cartSummary.Items)
                            {
                                <div class="d-flex justify-content-between mb-2">
                                    <div>
                                        <strong>@item.ConcertTitle</strong><br>
                                        <small class="text-muted">@item.TicketType × @item.Quantity</small>
                                    </div>
                                    <div class="text-end">
                                        <strong>RM @item.Subtotal.ToString("N2")</strong>
                                    </div>
                                </div>
                                <hr>
                            }
                            
                            <div class="d-flex justify-content-between mb-2">
                                <span>Total Items:</span>
                                <span class="fw-bold">@cartSummary.TotalItems ticket(s)</span>
                            </div>

                            <hr class="my-3">

                            <div class="d-flex justify-content-between">
                                <h4 class="mb-0">Total:</h4>
                                <h4 class="mb-0 text-primary">RM @cartSummary.TotalAmount.ToString("N2")</h4>
                            </div>
                        }
                    </div>
                    <div class="card-footer">
                        <button type="submit" class="btn btn-success btn-lg w-100 mb-2">
                            <i class="bi bi-lock-fill"></i> Complete Payment
                        </button>
                        <a asp-action="Index" class="btn btn-outline-secondary w-100">
                            <i class="bi bi-arrow-left"></i> Back to Cart
                        </a>

                        <div class="mt-3 text-muted small text-center">
                            <i class="bi bi-shield-check"></i> Your payment is secure and encrypted
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}
